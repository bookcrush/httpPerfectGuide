# HTTP 완벽가이드

## 클라이언트 식별과 쿠키

### 11.1 개별 접촉

HTTP 는 익명으로 사용하며 상태가 없고 요청과 응답으로 통신하는 프로토콜이다.
웹 서버는 요청을 보낸 사용자를 식별하거나 방문자가 보낸 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있다.

- 개별 인사: 온라인 쇼핑이 개인에게 맞춰져 있는 것처럼 느끼게 하려고 사용자에게 특화된 환영 메시지나 페이지 내용을 만든다.
- 사용자 맞춤 추천: 고객의 흥미를 학습하여 좋아할 것으로 예상되는 제품을 추천할 수 있다.
- 저장된 사용자 정보: 쇼핑을 편하게 할 수 있게 저장된 사용자 정보를 사용할 수 있다.
- 세션 추적: 위와 같은 사이트와의 상호작용을 위해서는 사용자에게서 오는 HTTP 트랜잭션을 식별할 방법이 필요하다. 
  - 사용자 식별 관련 정보를 전달하는 HTTP 헤더
  - IP 주소로 사용자를 식별
  - 사용자 로그인 인증을 통한 사용자 식별
  - URL 에 식별자를 포함하는 기술인 뚱뚱한 URL
  - 식별 정보를 지속해서 유지하는 강력하면서도 효율적인 기술인 쿠키
  
 ### 11.2 HTTP 헤더
 
| Form            | 요청 | 사용자의 이메일 주소                     |
|-----------------|------|------------------------------------------|
| User-Agent      | 요청 | 사용자의 브라우저                        |
| Referer         | 요청 | 사용자가 현재 링크를 타고 온 근원 페이지 |
| Authorization   | 요청 | 사용자 이름과 비밀번호                   |
| Client-ip       | 확장 | 클라이언트의 IP 주소                     |
| X-Forwarded-For | 확장 | 클라이언트의 IP 주소                     |
| Cookie          | 확장 | 서버가 생성한 ID 라벨                    |

- Form 헤더에는 사용자 이메일 주소를 포함한다. 악용될 여지가 있어 Form 헤더를 보내는 브라우저는 많지 않다. 로봇이나 스파이더는 웹 사이트에 항의메일을 보낼 수 있도록 Form 헤더에 이메일 주소를 기술한다.
- User-Agent 헤더는 사용자가 쓰고있는 브라우저의 이름과 버전 정보, 운영체제에 대한 정보를 포함한다. 
- Referer 헤더는 유입하게 한 웹페이지의 URL 을 가리킨다. 사용자 자체 식별은 불가하지만 사용자의 취향을 파악하는데 도움을 준다.

### 11.3 클라이언트 IP 주소 

클라이언트 IP 주소로 사용자를 식별하는 방식은 다음과 같은 약점을 가지고있다.

- 클라이언트 IP는 사용자가 아닌, 사용자가 사용하는 컴퓨터를 가리킨다.
- 동적으로 IP 주소를 할당 받을 경우 사용자는 매번 새로운 IP 주소를 할당 받는다
- 보안을 강화하기 위해 많은 사용자가 네트워크 주소 변환 방화벽을 통해 인터넷을 사용한다
- HTTP 프락시와 게이트웨이는 원 서버에 새로운 TCP 연결을 한다.

### 11.4 사용자 로그인

웹 서버는 사용자 이름과 비밀번호로 인증할 것을 요구해서 사용자에게 명시적으로 식별 요청을 할 수 있다.
웹 사이트 로그인이 더 쉽도록 HTTP 는 WWW-Authenticate 와 Authorization 헤더를 사용해 웹 사이트에 사용자 이름을 전달하는 자체적인 체계를 가지고 있다.

서버에서 접근전 로그인을 시키고자 한다면 401 Login Required 응답 코드를 브라우저에 보낼 수 있다.

### 11.5 뚱뚱한 URL

URL 은 URL 경로의 처음이나 끝에 어떤 상태 정보를 추가해 확장한다. 
뚱뚱한 URL 은 아래와 같은 문제점이 있다.

- 못생긴 URL: 뚱뚱한 URL 은 사용자에게 혼란을 준다.
- 공유하지 못하는 URL: 뚱뚱한 URL 은 사용자와 세션에 대한 상태 정보를 포함한다. 공유시 정보 노출에 위험이 있다.
- 캐시를 사용할 수 없음: URL이 달라지기 때문에 기존 캐시에 접근할 수 없다.
- 서버 부하 가중: 서버는 뚱뚱한 URL 에 해당하는 HTML 페이지를 다시 그려야 한다.
- 이탈: 의도치 않게 뚱뚱한 URL 세션에서 이탈했을때 이전 정보가 초기화된다.
- 세션 간 지속성의 부재: URL 을 북마킹 하지 않는이상 로그아웃하면 모든 정보를 잃는다.

## 11.6 쿠키 

쿠키는 사용자를 식별하고 세션을 유지하는 방식 중에서 현재까지 가장 널리 사용하는 방식이다.
쿠키는 캐시와 충돌할 수 있어서 대부분의 캐시나 브라우저는 쿠키에 있는 내용물을 캐싱하지 않는다.

### 11.6.1 쿠키의 타입 

크게 세션쿠키 / 지속 쿠키 두 가지 타입으로 나눌 수 있다.
세션 쿠키는 사용자가 사이트를 탐샐할 때, 관련한 설정과 신호 사항들을 저장하는 임시 쿠키다. 브라우저를 닫으면 삭제된다.
지속 쿠키는 삭제되지 않고 더 길게 유지될 수 있다. 디스크에 저장되어 브라우저를 닫거나 재시작하더라도 남아있다.
Expires 혹은 Max-Age 가 없으면 세션쿠키가된다.

### 11.6.2 쿠키는 어떻게 동작하는가

쿠키는 이름=값 형태의 리스트를 가진다. 리스트는 Set-Cookie 혹은 Set-Cookie2 같은 HTTP 응답 헤더에 기술되어 사용자에게 전달된다.
브라우저는 서버로부터 온 쿠키 컨텐츠를 브라우저 쿠키 데이터베이스에 저장한다.

### 11.6.3 쿠키 상자: 클라이언트 측 상태 

쿠키의 기본적인 발상은 브라우저가 서버 관련 정보를 저장하고, 사용자가 해당 서버에 접근할 떄마다 그 정보를 함께 전송하게 하는 것이다.
브라우저는 쿠키 정보를 저장할 책임이 있는데, 이 시스템을 클라이언트 측 상태라고한다. 쿠키 명세에서 이것의 공식적인 이름은 HTTP 상태 관리 체계이다.

#### 구글 크롬 쿠키: 구글 크롬은 Cookies 라는 SQLite 파일에 쿠키를 저장한다. 

- creation_utc: 쿠키가 생성된 시점
- host_key: 쿠키의 도메인
- name: 쿠키의 이름
- value: 쿠키의 값
- path: 쿠키와 관련된 도메인에 있는 경로
- expire_utc: 쿠키의 파기 시점 
- secure: 쿠키를 SSL 커넥션일 경우에만 보낼지 여부















