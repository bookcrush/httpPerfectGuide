# HTTP

## 6.6 메시지 추적

프락시가 점점 흔해지면서, 서로 다른 스위치와 라우터를 넘나드는 IP 패킷의 흐름을 추적하는 것 못지 않게 프락시를 넘나드는 메시지의 흐름을 추적하고 문제점을 찾아내는 것도 필요한 일이 되었다.

### 6.6.1 Via 헤더 

Via 헤더 필드는 메시지가 지나는 가 중간 노드의 정보를 나열한다.
메시지의 전달을 추적하고, 메시지 루프를 진단하고, 요청을 보내고 그에 대한 응답을 돌려주는 과정에 관여하는 모든 메시지 발송자들의 프로토콜을 다루는 능력을 알아보기 위해 사용된다.

Via 문법

```text
Via = "Via":" { waypoint } [", "{ waypoin } ...]
waypoint = ( received-protocol received-by [ comment ] )
received-protocol = [ protocol-name "/" ] protocol-version 
receved-by = ( host [ ":" prot ] ) | pseudnym
```

- 프로토콜 이름: 프로토콜이 만약 HTTP 라면 프로토콜 이름은 없어도 된다. 프로토콜 이름은 버전 앞에 "/" 로 구분되어 붙는다. 
- 프로토콜 버전: 버전의 포맷은 프로토콜에 달려있다. 버전은 via 필드에 포함되므로, 애플리케이션들은 자신 이전의 모든 중개자들이 어떤 버전을 다룰 수 있는지 알 수 있다.
- 노드 이름: 정보 보호를 이유로 진짜 호스트 명을 밝히고 싶지 않을때 가명으로 대체 할 수 있다.
- 노드 코멘트: 중개자 노드를 서술하는 선택적인 코멘트, 벤더나 버전 정보를 포함
- Via 요청과 응답 경로: 요청 메시지와 응답 메시지 모두 프락시를 지나므로 둘 모두 Via 헤더를 가진다. 응답의 Via 헤더는 언제나 요청 Via 헤더의 반대다
- Via 게이트웨이: 서버에게 비 HTTP 프로토콜을 사용할 수 있는 게이트웨이 기능을 제공한다. 선택적 코멘트는 프락시 서버의 브랜드, 버전 번호, 몇 가지 벤더 진단 정보를 포함한다.
- Server 헤더와 Via 헤더: Server 응답 헤더 필드는 원 서버에 의해 사용되는 소프트웨어를 알려준다. 
- Via 가 개인정보 보호와 보안에 미치는 영향: 호스트 명이 노출되기 원치 않는다면 호스트명을 가명으로 교체해야한다. 프락시는 정렬된 일련의 via 유지 항목들을 하나로 합칠 수 있다. 경유지들이 모두 같은 조직의 통제하에 있고 호스트가 이미 가명으로 교체되지 않은 이상 그들에 대한 항목들을 합쳐서는 안된다. 프로토콜 값이 서로 다른 항목들도 합쳐서는 안된다.
