# HTTP

## 3.1 메시지의 흐름

HTTP 메세지는 애플리케이션 간에 주고받은 데이터의 블록들이다. 메시지의 내용과 의미를 설명하는 텍스트 메타 정보와 선택적으로 데이터가 올 수 있다.

### 3.1.1메시지는 원 서버 방향을 인바운드로 하여 송신된다

메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드이다.

### 3.1.2 다운스트림으로 흐르는 메세지

모든 메세지는 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다.

## 3.2 메시지의 각 부분

각 메세지는 시작줄, 헤더 블록, 본문 세 부분으로 이루어진다.
시작줄은 어떤 메시지인지 서술하며, 헤더 블록은 속성, 본문은 데이터를 담고있다.

### 3.2.1 메시지 문법

메시지는 요청 메시지와 응답 메시지로 나누어진다.

    // 요청 메시지 형식

    <메서드> <요청 URL> <버전>
    <헤더>
    <엔터티 본문>

    // 응답 메시지 형식

    <메서드> <상태 코드> <사유 구절>
    <헤더>
    <엔터티 본문>

- 메서드: 서버가 리소스에 대해 수행해주길 바라는 동작
- 요청 URL: 요청 대상이 되는 리소스를 지칭하는 URL
- 버전: 메시지에서 사용하는 HTTP 버전
- 상태코드: 성공, 에러등을 나타내는 세 자리의 숫자
- 사유 구절: 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 문구
- 헤더들: 이름, 콜론, 선택적인 공백, 값, CRLF 가 순서대로 나타나는 0 개 이상의 헤더들
- 엔터티 본문: 데이터 블록을 포함한다.

### 3.2.2 시작줄

메세지의 시작줄은 무엇을 해야 하는지 말해준다.

- 요청줄: 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 동작에 대한 대상을 지칭하는 요청 URL 이 들어있다
- 응답줄: 응답 메시지에서 쓰인 HTTP 의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트 사유구절
- 메서드: 서버에게 무엇을 해야하는지 말해준다.
- 상태코드: 클라이언트에게 무엇이 일어났는지 말해준다. (100 - 정보, 200 - 성공, 300 - 리다이렉션, 400 - 클라이언트 에러, 500 - 서버에러)
- 사유구절: 상태 코드에 대한 글로 된 설명을 제공한다.
- 버전 번호: 응답, 요청 메세지 모두에 기술된다. 자신이 따르는 프로토콜 버전을 상대방에게 말해주기 위한 수단이 된다.

### 3.2.3 헤더

헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다.

- 일반 헤더: 요청과 응답 양쪽에 모두 나타낼 수 있다.
- 요청 헤더: 요청에 대한 부가 정보를 제공
- 응답 헤더: 응답에 대한 부가 정보를 제공
- Entity 헤더: 본문 크기와 콘텐츠, 리소스 그 자체를 서술
- 확장 헤더: 명세에 정의되지 않은 새로운 헤더

### 3.2.4 엔터티 본문

HTTP 메세지는 이미지, 비디오, HTML 문서 등 여러 종류의 디지털 데이터를 실어 나를 수 있다.

## 3.3 메서드

### 3.3.1 안전한 메서드

GET, HEAD 메서드는 안전한 메서드이다. 이는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.

### 3.3.2 GET

서버에게 리소스를 달라고 요청하기 위해 쓰인다.

### 3.3.3. HEAD

GET 처럼 행동하지만, 서버는 응답으로 헤더만 돌려준다.

- 응답의 상태 코드를 통해, 개체의 존재 유무를 알 수 있다.
  = 리소스가 변경되었는지 검사 할 수 있다.

### 3.3.4 PUT

서버가 요청의 본문을 가지고 요청 URL 의 이름대로 새 문서를 만들거나, 이미 URL 이 존재한다면 본문을 사용해서 교체하는 것이다.

### 3.3.5 POST

서버에 입력 데이터를 전송하기 위해 설계

### 3.3.6 TRACE

클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려준다.
주로 진단을 위해서 사용된다.

### 3.3.7 OPTIONS

웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어본다. 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다.

### 3.3.8 DELETE

서버에게 요청 URL 로 지정한 리소스를 삭제할 것을 요청한다.

## 3.4 상태 코드

### 3.4.1 100-109: 정보성 상태 코드

#### 100(Continue)

클라이언트는 나머지를 계속이어서 보내야 함을 의미한다.
100-Continue 는 최적화를 위한 것이다. 클라이언트 애플리케이션은 100-Continue 를 서버가 다루거나 사용할 수 없는 큰 엔터티를 서버에게 보내지 않으려는 목적으로만 사용해야 한다.

프락시가 다음 홉 서버들에 대한 상태 몇 가지와 그들이 지원하는 HTTP 버전을 기억해둔다면, 100-continue 응답을 기대한 요청을 더 잘 다룰 수 있게 되므로 프락시에게 이득이 된다.

#### 101(Switching Protocols)

클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음을 의미한다.

### 3.4.2 200-299: 성공 상태 코드

| 상태코드 | 사유구절                      | 의미                                                                    |
| -------- | ----------------------------- | ----------------------------------------------------------------------- |
| 200      | ok                            | 요청은 정상이고, 엔터티 본문은 요청된 리소스를 포함하고 있다.           |
| 202      | accepted                      | 요청은 받아들여졌으나 서버는 아직 어떤 동작도 수행하지 않았다.          |
| 203      | non-authoritative Information | 엔터티 헤더가 아닌 리소스의 사본에서 왔다.                              |
| 204      | no content                    | 응답 메시지는 헤더와 상태줄을 포함하지만 엔터티 본문은 포함하지 않는다. |
| 205      | reset content                 | 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비우라고한다 |
| 206      | partial content               | 부분 혹은 범위 요청이 성공했다                                          |

### 3.4.3 300-399: 리다이렉션 상태 코드

| 상태코드 | 사유구절           | 의미                                                                                                                                                                 |
| -------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 300      | multiple choices   | 클라이언트가 여러 리소스를 가리키는 URL 을 요청한 경우, 그 리소스의 목록과 함께 반환한다                                                                             |
| 301      | moved permanently  | 요청한 URL이 옮겨졌을 때 사용한다.                                                                                                                                   |
| 302      | found              | 301 상태코드와 같다. 그러나 클라이언트는 location 헤더로 주어진 URL을 리소스를 임시로 가리키기 위한 목적으로 사용해야한다.                                           |
| 303      | see other          | 리소스를 다른 URL에서 가져와야 한다고 말해주고자 할때 쓰인다                                                                                                         |
| 304      | not modified       | 헤더를 이용해 조건부 요청을 만들 수 있다.                                                                                                                            |
| 305      | use proxy          | 리소스가 반드시 프락시를 통해서 접근되어야 함을 나타내기 위해 사용한다.                                                                                              |
| 307      | temporary redirect | 301 상태코드와 같다. 그러나 클라이언트는 location 헤더로 주어진 URL을 리소스를 임시로 가리키기 위한 목적으로 사용해야한다. 이후 요청에서는 원래 URL을 사용해야 한다. |

### 3.4.4 400-499: 클라이언트 에러 상태 코드

| 상태코드 | 사유구절                        | 의미                                                                                                    |
| -------- | ------------------------------- | ------------------------------------------------------------------------------------------------------- |
| 400      | bad request                     | 잘못된 요청                                                                                             |
| 401      | unauthorized                    | 인증하라고 요구하는 내용의 응답을 적절한 헤더와 함께 반환한다.                                          |
| 402      | payment required                | 현재 사용되지 않고있다.                                                                                 |
| 403      | forbidden                       | 요청이 서버에 의해 거부되었음을 알려주기 위해 사용                                                      |
| 404      | not found                       | 요청한 URL을 찾을 수 없음을 알려주기 위해 사용                                                          |
| 405      | method not allowed              | 지원하지 않는 메서드로 요청을받았을 때 사용                                                             |
| 406      | not aceeptable                  | 어떤 종류의 엔터티를 받아들이고자 하는지에 대해 매개변수로 명시할 수 있다.                              |
| 407      | proxy authentication required   | 401 상태코드와 같으나, 리소스에 대해 인증을 요구하는 프락시 서버를 위해 사용한다                        |
| 408      | request timeout                 | 요청을 완수하기에 시간이 너무 많이 걸리는 경우, 서버는 408 코드를 반환하고 응답하고 연결을 끊을 수 있다 |
| 409      | confilct                        | 리소스에 대해 일으킬 수 있는 몇몇 충돌을 지칭하기 위해 사용                                             |
| 410      | gone                            | 404와 비슷하나 서버가 한때 그 리소스를 가지고 있었다는 점이 다르다                                      |
| 411      | length required                 | 서버가 요청 메시지에 content-length 헤더가 있을 것을 요구한다                                           |
| 412      | precondition failed             | 조건부 요청을 했는데 그중 하나가 실패했을 때 사용한다                                                   |
| 413      | request entity too large        | 한계의 크기를 넘은 요청을 클라이언트가 보냈을때                                                         |
| 414      | request uri to long             | 한계의 길이를 넘은 요청 url 이 포함된 클라이언트가 보냈을때                                             |
| 415      | unsupported media type          | 서버가 이해하거나 지원하지 못하는 내용 유형의 엔터티를 클라이언트가 보넀을 때 사용                      |
| 416      | requested range not satisfiable | 요청 메시지가 리소스의 특정 범위를 요청했는데, 그 범위가 잘못되었거나 맞지 않을때                       |
| 417      | expectation failed              | 요청에 포함된 expect 요청 헤더에 서버가 만족시킬 수 없는 기대가 담겨있는 경우 사용                      |

### 3.4.5 500-599: 서버 에러 상태 코드

| 상태코드 | 사유구절                   | 의미                                                                                                |
| -------- | -------------------------- | --------------------------------------------------------------------------------------------------- |
| 500      | internal sever error       | 서버가 요청을 처리할 수 없게 만드는 에러를 만났을 때 사용                                           |
| 501      | not implemented            | 클라이언트가 서버의 능력을 넘은 요청을 했을 때 (지원 x 메서드 등)                                   |
| 502      | bad gateway                | 가짜 응답에 맞닥뜨렸을 때 사용                                                                      |
| 503      | service unavailable        | 현재는 요청을 처리할 수 없지만 나중에는 가능함을 의미                                               |
| 504      | gateway timeout            | 408과 비슷하지만 응답을 기다리다 타임아웃이 발생한 게이트웨이나 프락시에서 온 응답이라는점이 다르다 |
| 505      | http version not supported | 지원하지 않으려고 하는 버전의 프로토콜로 된 요청을 받았을 때                                        |

## 3.5 헤더

헤더와 메서드는 클라이언트와 서버가 무엇을 하는지 결정하기 위해서 사용된다.

- 일반헤더: 서버, 클라이언트 양쪽에서 사용, 메시지를 보내는 다른 애플리케이션들을 위해 다양한 목적으로 사용
- 요청 헤더: 요청 메시지를 위한 헤더, 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 정보를 제공
- 응답 헤더: 응답 메세지는 클라이언트에게 정보를 제공하기 위한 자신만의 헤더를 가지고 있다.
- 엔터티 헤더: 본문에 대한 헤더를 말한다. 본문에 들어있는 데이터의 타입이 무서인지 말해줄 수 있다.
- 확장 헤더: 비표준 헤더다.

### 3.51 일반 헤더

메시지에 대한 아주 기본적인 정보를 제공한다.

- connection: 클라이언트와 서버가 요청/응답 연결에 대한 옵션을 정할 수 있게 해준다.
- date\*: 메시지가 언제 만들어졌는지에 대한 날짜와 시간을 제공
- mime-version: 발송자가 사용한 mime 의 버전을 알려준다.
- trailer chunked transfer: 인코딩으로 인코딩된 메시지의 끝 부분에 위치한 헤더들의 목록을 나열한다.
- trasfer-encoding: 전송을 위해 어떤 인코딩이 적용되었는지 말해준다.
- upgrade: 새 버전이나 프로토콜을 알려준다.
- via: 어떤 중개자로부터 왔는지 알려준다.

#### 일반 캐시 헤더

- cache-control: 메시지와 함께 캐시 지시자를 전달하기 위해 사용한다.
- pragma: 메시지와 함꼐 지시자를 전달하는 또 다른 방법. 캐시에 국한되지 않는다.

### 3.5.2 요청 헤더

요청 메시지에서만 의미를 갖는 헤더다.최초 발생한곳에서 누가 혹은 무엇이 그 요청을 보냈는지, 클라이언트의 선호나 능력에 대한 정보를 준다.

- client-ip, from, host, referer, os, user agent 등 ...

#### accept 관련 헤더

서버에게 자신의 선호와 능력을 알려 줄 수 있다. 서버는 이 정보를 활용해서 무엇을 보낼 것인가에 대한 처리를 할 수 있다.

- accept: 보내도 되는 미디어의 종류
- accept - charset, encoding, language, te: 보내도되는 문자집합, 인코딩, 언어, 전송코딩

#### 조건부 요청 헤더

요청에 몇몇 제약을 넣을 수 있다.

- expect: 요청에 필요한 서버의 행동을 열거
- if-match: 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하는 경우에만 문서를 가져온다.
- if-modified-since: 주어진 날짜 이후에 리소스가 변경되지 않았다면 요청을 제한
- if-none-match: 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하지 않는 경우에만 문서를 가져온다.
- if-range: 특정 범위에 대한 요청을 할 수 있게 해준다.
- if-unmodified-since: 주어진 날짜 이후에 리소스가 변경되었다면 요청을 제한한다.
- range: 특정 범위에 대한 요청

#### 요청 보안 헤더

HTTP는 자체적으로 요청을 위한 간단한 인증요구/응답 체계를 갖고 있다.

- authorization: 클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보를 담고있다.
- cookie: 클라이언트가 서버에게 토큰을 전달할 때 사용한다.
- cookie2: 요청자가 지원하는 쿠키의 버전을 알려줄 때 사용한다.

#### 프락시 요청 헤더

프락시의 기능을 돕기 위해 몇몇 헤더들이 정의되었다.

- max-forwards: 프락시나 게이트웨이로 전달될 수 있는 최대 횟수
- proxy-authorization: 프락시에서 인증을 할 때 쓰인다.
- proxy-connect: 프락시에서 연결을 맺을 때 쓰인다.

### 3.5.3 응답 헤더

클라이언트에게 부가 정보를 제공한다.

- age: 응답이 얼마나 오래되었는지
- public: 특정 리소스에 대해 지원하는 요청 메서드의 목록
- retry-after: 현재 리소스가 사용불가일때 언제 가능해지는지 날짜 혹은 시각
- server: 서버 애플리케이션의 이름과 버전
- title: html 문서에서 주어진 것과 같은 제목
- warning: 사유 구절에 있는 것보다 더 자세한 경고 메세지

#### 협상 헤더

서버가 협상 가능한 리소스에 대한 정보를 운반하는 몇 가지 헤더들이 있다.

- accept-ranges: 범위의 형태
- vary: 응답에 영향을 줄 수 있는 헤더들의 목록

#### 응답 보안 헤더

인증요구 헤더

- proxy-authenticate: 프락시에서 클라이언트로 보낸 인증요구의 목록
- set-cookie: 서버가 클라이언트를 인증할 수 있도록 클라이언트 측에 토큰을 설정하기 위해 사용
- www-authenticate: 서버에서 클라이언트로 보낸 인증요구의 목록

### 3.5.4 엔터티 헤더

엔터티와 그것의 내용물에 대한, 개체의 타입부터 시작해서 주어진 리소스에 대해 요청 할 수 있는 유요한 메서드들까지 광범위한 정보를 제공한다.

- allow: 수행될 수 있는 요청 메서드들을 나열한다.
- location: 클라이언트에게 엔터티가 실제로 어디에 위치하고 있는지 말해준다.

#### 콘텐츠헤더

엔터티의 콘텐츠에 대한 구체적인 정보를 제공한다.

- content-base: 기저 url
- content-encoding: 적용된 인코딩
- content-language: 적절한 언어
- content-length: 본문의 길이나 크기
- content-location: 리소스의 위치
- content-md5: md5 체크섬
- content-range: 범위를 바이트 단위로 표현
- content-type: 어떤 종류의 객체인지

#### 엔터티 캐싱 헤더

언제 어떻게 캐시가 되어야 하는지에 대한 지시자를 제공

- etag: 엔터티 태그
- expires: 엔터티가 더 이상 유효하지 않아 원본을 다시 받아와야 하는 일시
- last-modified: 가장 최근 엔터티가 변경된 일시
