# HTTP

## 보안 HTTP

## 14.1 HTTP 를 안전하게 만들기

중요한 트랜잭션을 위해서는 HTTP 와 디지털 암호화 기술을 결합해야 한다.
HTTP 의 보안 버전은 효율적이고, 이식성이 좋아야 하고, 관리가 쉬워야 하며, 현실 세계의 변화에 대한 적응력이 좋아야 한다.

### 14.1.1 HTTPS 

HTTPS 를 사용할 때, 모든 HTTP 요청과 응답 데이터는 네트워크로 보내지기 전에 암호화된다.
HTTPS 는 HTTP 의 하부에 전송 레벨 암호 보안 계층을 제공함으로써 동작하는데, 이 보안 계층은 안전 소켓 계층 혹은 그를 계승한 전송 계층 보안을 이용하여 구현된다.
SSL 과 TLS 는 매우 비슷하다.

## 14.2 디지털 암호학 

- 암호: 텍스트를 아무나 읽지 못하도록 인코딩하는 알고리즘
- 키: 암호의 동작을 변경하는 숫자로 된 매개변수
- 대칭키 암호 체계: 인코딩과 디코딩에 같은 키를 사용하는 알고리즘
- 비대칭키 암호 체계: 인코딩과 디코딩에 다른 키를 사용하는 알고리즘
- 공개키 암호법: 비밀 메시지를 전달하는 수백만 대의 컴퓨터를 쉽게 만들 수 있는 시스템
- 디지털 서명: 메시지가 위조 혹은 변조되지 않았음을 입증하는 체크섬
- 디지털 인증서: 신뢰할 만한 조직에 의해 서명되고 검증된 신원 확인 정보 

### 14.2.1 비밀 코드의 기술과 과학 

암호법은 메시지 인코딩과 디코딩에 대한 기술이다. 암호법은 단순히 볼 수 없도록 메시지를 암호화하는 것뿐 아니라 
메시지의 변조를 방지하기 위해 사용할 수도 있다.

### 14.2.2 암호

암호법은 암호라 불리는 비밀 코드에 기반한다. 암호란 메시지를 인코딩하는 어떤 특정한 방법과 나중에 그 비밀 메시지를 디코딩하는 방법이다.
인코딩되기 전의 원본 메시지는 흔히 텍스트 혹은 평문이라고 불린다.
암호가 적용되어 코딩된 메시지는 보통 암호문이라고 불린다.

### 14.2.3 암호 기계

기술이 진보하면서 복잡한 암호로 메시지를 빠르고 정확하게 인코딩하고 디코딩하는 기계를 만들기 시작하였다.
암호 기계는 암호를 깨뜨리기 어렵게 하기 위해, 단순히 회전을 하는 대신 글자들을 대체하고, 순서를 바꾸며 메시지를 자르고 토막내었다.

### 14.2.4 키가 있는 암호 

대부분의 기계들에는 암호의 동작방식을 변경할 수 있는 큰 숫자로 된 다른 값을 설정할 수 있는 다이얼이 달려있다.
누군가 기계를 훔치더라도 올바른 다이얼 설정이 없이는 디코더가 동작하지 않을 것이다.
암호 키는 하나의 암호 기계를 여러 가상 암호 기계의 집합처럼 만들어준다.
가상 암호 기계들은 서로 다른 키 값을 갖고 있기 때문에 제각각 다르게 동작한다.
암호 알고리즘은 'N 번 회전' 암호다. N 의 값은 키에 의해 좌우된다. 같은 메시지가 같은 인코딩 기계를 통과하더라도 키의 값에 따라 다른 출력을 생성한다.

### 14.2.5 디지털 암호 

- 속도 및 기능에 대한 기계 장치의 한계에서 벗어남으로써, 복잡한 인코딩과 디코딩 알고리즘이 가능해졌다.
- 큰 키를 지원하는 거이 가능해져서, 단일 암호 알고리즘으로 키의 값마다 다른 수조 개의 가상 암호 알고리즘을 만들어 낼 수 있게 되었다.

기계 장치의 물리적인 금속 키나 다이얼 설정과는 달리, 디지털 키는 그냥 숫자에 불과하다. 
디지털 키 값은 인코딩과 디코딩 알고리즘에 대한 입력값이다. 
코딩 알고리즘은 데이터 덩어리를 받아서 알고리즘과 키의 값에 근거하여 인코딩하거나 디코딩하는 함수이다.

## 14.3 대칭키 암호법 

디지털 암호 알고리즘은 대칭키 암호라 불리는데, 그들이 인코딩 할 때 사용하는 키가 디코딩을 할 때와 같기 때문이다.
대칭키 암호에서 발송자와 수신자 모두 통신을 위해 비밀 키 k 를 똑같이 공유할 필요가 있다.
발송자는 공유된 비밀 키를 메시지를 암호화하고 결과인 암호문을 수신자에게 발송하기 위해 사용한다.
수신자는 암호문을 받은 뒤 같은 공유된 키를 사용하여 평문을 복원하기 위해 해독 함수를 적용한다.

### 14.3.1 키 길이와 열거 공격 

좋은 암호 알고리즘은 공격자가 코드를 크래킹하려면 존재하는 모든 가능한 키 값을 시도해보는 것 외에 다른 방법이 없게 만든다.
가능한 키 값의 개수는 키가 몇 비트이며 얼마나 많은 키가 유효한지에 달려있다.
대칭키 암호에서는 모든 키 값이 유효하다. 
평범한 대칭키 암호에서, 40비트 키는 작고 중요하지 않은 업무에는 충분하다고 할 수 있다.
128비트 키를 사용한 대칭키 암호는 매우 강력하다.

### 14.3.2 공유키 발급하기

대칭키 암호의 단점 중 하나는 발송자와 수신자가 서로 대화하려면 둘 다 공유키를 가져야 한다는 것이다.

## 14.4 공개키 암호법 

한 쌍의 호스트가 하나의 인코딩/디코딩 키를 사용하는 대신, 공개키 암호 방식은 두 개의 비대칭 키를 사용한다.
하나는 호스트의 메시지를 인코딩하기 위한 것이며, 다른 하나는 호스트의 메시지를 디코딩하기 위한 것이다.
메시지를 디코딩하는 능력은 소유자에게만 부여한다.

### 14.4.1 RSA

공개키 암호 체계중 유명한 하나는 MIT 에서 발명되고 이어서 RSA 데이터 시큐리티에서 상용화된 RSA 알고리즘이다.

### 14.4.2 혼성 암호 체계와 세션 키

공개키 암호 방식의 알고리즘은 계싼이 느린 경향이 있다.
실제로는 대칭과 비대칭 방식을 섞은 것이 쓰인다.
노드들 사이의 안전한 의사소통 채널을 수립할 때는 편리하게 공개 키 암호를 사용하고,
안전한 채널을 통해 임시의 무작위 대칭 키를 생성하고 교환하여 이후의 나머지 데이터를 암호화할 때는 빠른 대칭키를 사용한다.

## 14.5 디지털 서명 

암호 체계는 메시지를 암호화하고 해독하는 것뿐 아니라, 누가 메시지를 썼는지 알려주고 그 멤시지가 위조되지 않았음을 증명하기 위해 메시지에 서명을 하도록하는데에 이용될 수 있다.

### 14.5.1 서명은 암호 체크섬이다

디지털 서명은 메시지에 붙어있는 특별한 암호 체크섬이다.

- 서명은 메시지를 작성한 저자가 누군지 알려준다. 저자는 저자의 극비 개인 키를 갖고 있기 때문에, 오직 저자만이 체크섬을 계싼할 수 있다.
- 서명은 메시지 위조를 방지한다. 악의적인 공격자가 송신 중인 메시지를 수정했다면, 체크섬은 더 이상 그 메시지와 맞지 않게된다. 체크섬 날조가 불가하다

디지털 서명은 보통 비대칭 공개키에 의해 생성된다. 개인 키는 오직 소유자만이 알고 있기 떄문에, 저자의 개인 키는 일종의 지문처럼 사용된다.

- 가변 길이 멤시지를 정제하여 고정된 길이의 요약으로 만든다.
- 요약에, 사용자의 개인 키를 매개변수로 하는 서명 함수를 적용한다 
- 한번 서명이 계산되면 메시지의 끝에 그것을 덧붙이고 메시지와 그에 대한 서명 둘 다를 전송한다.
- 개인 키로 알아보기 어렵게 변형된 서명에 공개키를 이용한 역함수를 적용한다. 만약 풀어낸 요약이 버전의 요약과 일치하지 않는다면, 메시지가 송신 중에 위조되었거나 발송자가 개인 키를 갖고 있지 않은것이다


## 14.6 디지털 인증서 

디지털 인증서는 신뢰할 수 있는 기관으로부터 보증 받은 사용자나 회사에 대한 정보를 담고 있다.

### 14.6.1 인증서의 내부 

디지털 인증서에는 공식적으로 '인증기관' 에 의해 디지털 서명된 정보의 집합이 담겨있다.
디지털 인증서는 대상과 사용된 서명 알고리즘에 대한 서술적인 정보뿐 아니라 보통 대상의 공개키도 담고있다.
누구나 디지털 인증서를 만들 수 있지만, 모두가 인증서의 정보를 보증하고 인증서를 개인 키로 서명할 수 있는 서명 권한을 얻을 수 있는 것은 아니다.

### 14.6.2 x.509 v3 인증서 

디지털 인증서에 대한 전 세계적인 단일 표준은 없다. 
오늘날 사용되는 인증서가 그들의 정보를 x.509 라 불리는 표준화된 서식에 저장하고 있다.
x.509 v3 인증서는 인증 정보를 파싱 가능한 필드에 넣어 구조화하는 표준화된 방법을 제공한다.

- 버전: 인증서가 따르는 버젼 번호, 요즘은 보통 3 버전이다.
- 일련번호: 인증기관에 의해 생성된 고유한 정수
- 서명 알고리즘 ID: 서명을 위해 사용된 알고리즘
- 인증서 발급자: 인증서를 발급하고 서명한 기관의 이름
- 유효 기간: 인증서가 유효한 기간
- 대상의 이름: 인증서에 기술된, 사람이나 조직과 같은 엔터티
- 대상의 공개 키 정보: 인증 대상의 공개 키, 공개 키에 사용된 알고리즘
- 발급자의 고유 ID: 발급자 이름이 겹치는 경우를 대비한 고유한 식별자
- 대상의 고유 ID: 대상의 이름이 겹치는 경우를 대비한, 인증 대상에 대한 선택적인 고유한 식별자
- 확장: 선택적인 확장 필드의 집합버젼
 
 ### 14.6.3 서버 인증을 위해 인증서 사용하기 
 
 사용자가 HTTPS 를 통한 안전한 웹 트랜잭션을 시작할 때, 최신 브라우저는 자동으로 접속한 서버에서 디지털 인증서를 가져온다.
 만약 서버가 인증서를 갖고 있지 않다면, 보안 커넥션은 실패한다.









